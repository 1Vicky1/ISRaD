---
title: "ISRaD user manual"
author: "Corey Lawrence and Grey Monroe"
date: "9/14/2018"
output: html_document
permalink: /manual/
---

## How to install the database
Current version is v0.1
For earlier versions, or the development version, visit our website.

```{r eval=FALSE}
install.packages("devtools")
install_github("International-Soil-Radiocarbon-Database/ISRaD")
library(ISRaD)
```
Once installed, the **ISRaD** package provides the pre-compiled version of database associated with the most current data release. These data are formated as a list called `ISRaD_data`. 

Summary statistics for `ISRaD_data` can be output with the `reports` function. 

```{r eval=FALSE}
reports(ISRaD_data, report="entry_stats")
```
At present, there is only one report type available (i.e. `entry_stats`) but several additional reports are currently being developed and advanced users may submit thier own report functions for inclusion in the base package.

## Structure of data
`ISRaD_data` is a list comprised of 8 data.frames (`metadata`, `site`, `profile`, `flux`, `layer`, `interstitial`, `fraction`, and `incubation`), which correspond to the template data tables. 

## How to compile user data locally
Some users may wish to compile thier own data locally in order view it in the context of the larger database. *(note: that this operation is not the same as submitting your data for ingest)*

The `compile` function is used QA/QC and assemble additional datasets (that pass the QA/QC test) into an new list, which can later be merged with `ISRaD_data`. 

In order to run `compile` on a set of user specified data entries, the user must create a local folder whose path is specified with `dataset_directory`. This folder must *only contain* the entries to be compiled in .xlsx format. If other files types exist in the directory, `compile` will fail. *(note: entries cannot be open in Excel)*

```{r eval=FALSE }
compiled<-compile(dataset_directory = "~/Directory/to/data/", write_report = T, write_out = T, return="list")
```
The paramter `return` determines format of the object that is returned and should be set to "list" unless the user prefers a flattend version of the database formatted as a single data.frame.

When set to "TRUE", the parameter `write_out` will trigger the creation of several output files:

| Description | Location | File name |
| ----------------------------- |:-------:| ------------:|
| Report files that identify issues with the files in the dataset_directory | dataset_directory/QAQC  | QAQC_\*.txt (\* corresponds to dataset file names) |
| Flattened database file    | dataset_directory/database       |   ISRaD_flat.csv |
| List structured database file in the same format as template | dataset_directory/database  |    ISRaD_list.xlsx |
| Log file generated by compile function. Most importatntly, tells you which files passed QAQC. | dataset_directory/database  |   ISRaD_log.txt |
| Summary statistics for datasets compiled into databaser | dataset_directory/database  |   ISRaD_summary.csv |
| QAQC check on compiled database. | dataset_directory/database  |  QAQC_ISRaD_list.txt |

## Merging a user compiled list with `ISRaD_data`
The function `mapply` can be used to merge the user compiled list with `ISRaD_data` as follows:
```{r eval=FALSE }
merged_data<-mapply(rbind, ISRaD_data, compiled, SIMPLIFY=FALSE)
```

## How to subset the database
We use packages `dplyr` for filtering data and `ggplot` for plotting. Both packages are included in the `tidyverse` library. 
```{r eval=FALSE }
library(tidyverse)
```
to be continued...

## Simple visualization of the data
Quick and simple visualization is possible by calling a Shiny app.
```{r eval=FALSE }
ISRaD.shiny()
```
